<Page
    x:Class="UsageLogger.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:UsageLogger.Helpers"
    xmlns:models="using:UsageLogger.Models"
    xmlns:l="using:WinUI3Localizer"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Unsaved Changes Banner -->
        <Grid x:Name="UnsavedChangesBanner" Grid.Row="0" Background="{ThemeResource AccentFillColorDefaultBrush}" Visibility="Collapsed" Padding="20,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock l:Uids.Uid="Settings_UnsavedChanges" Foreground="White" FontWeight="SemiBold"/>
            <Button Grid.Column="1" l:Uids.Uid="Settings_ApplyChanges" Click="ApplyAll_Click" Background="White" Foreground="Black" BorderThickness="0"/>
        </Grid>

        <ScrollViewer Grid.Row="1" Padding="20">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MaxWidth="800"/>
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0" Spacing="10" HorizontalAlignment="Stretch">
            
            <TextBlock l:Uids.Uid="Settings_Title" Style="{ThemeResource TitleTextBlockStyle}" Margin="0,0,0,10"/>

            <!-- App Runtime -->
            <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" IsExpanded="False">
                <Expander.Header>
                    <StackPanel Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_AppRuntime" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        <TextBlock l:Uids.Uid="Settings_AppRuntimeSummary" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                </Expander.Header>
                <StackPanel Spacing="5" Padding="0,10,0,0">
                    <!-- Run on Startup -->
                    <Grid x:Name="GridRunOnStartup" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Spacing="2">
                            <TextBlock l:Uids.Uid="Settings_RunOnStartup" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                            <TextBlock l:Uids.Uid="Settings_RunOnStartupDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                        </StackPanel>
                        <ComboBox x:Name="StartupModeComboBox" Grid.Column="1" MinWidth="180" SelectionChanged="StartupModeComboBox_SelectionChanged">
                            <ComboBoxItem Tag="None" l:Uids.Uid="Settings_StartupModeNone"/>
                            <ComboBoxItem Tag="TrackerOnly" l:Uids.Uid="Settings_StartupModeTracker"/>
                            <ComboBoxItem Tag="TrackerAndUI" l:Uids.Uid="Settings_StartupModeBoth"/>
                        </ComboBox>
                    </Grid>
    
                    <!-- Minimize on Exit -->
                    <Grid x:Name="GridMinimizeOnExit" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Spacing="2">
                            <TextBlock l:Uids.Uid="Settings_MinimizeOnExit" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                            <TextBlock l:Uids.Uid="Settings_MinimizeOnExitDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                        </StackPanel>
                        <ToggleSwitch x:Name="ToggleMinimizeOnExit" Grid.Column="1" Toggled="ToggleMinimizeOnExit_Toggled"/>
                    </Grid>
                </StackPanel>
            </Expander>

            <!-- Usage Data -->
            <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" IsExpanded="False">
                <Expander.Header>
                     <StackPanel Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_UsageData" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        <TextBlock l:Uids.Uid="Settings_UsageDataSummary" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                     </StackPanel>
                </Expander.Header>
                <StackPanel Spacing="10" Padding="0,10,0,0">

            <!-- Incognito Mode -->
            <Grid x:Name="GridIncognito" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Spacing="2">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE72E;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        <TextBlock l:Uids.Uid="Settings_IncognitoMode" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    </StackPanel>
                    <TextBlock l:Uids.Uid="Settings_IncognitoModeDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                </StackPanel>
                <ToggleSwitch x:Name="ToggleIncognitoMode" Grid.Column="1" Toggled="ToggleIncognitoMode_Toggled"/>
            </Grid>
            
            <!-- Excluded Apps -->
            <Grid Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Spacing="2" Margin="0,0,0,10">
                    <TextBlock l:Uids.Uid="Settings_ExcludedApps" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    <TextBlock l:Uids.Uid="Settings_ExcludedAppsDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                </StackPanel>
                <ListView Grid.Row="1" x:Name="ExcludedAppList" MaxHeight="150" DoubleTapped="ExcludedAppList_DoubleTapped" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" CornerRadius="4"/>
            </Grid>

            <!-- Hidden SubApps (Privacy Filter) -->
            <Grid x:Name="GridHiddenSubApps" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Spacing="2" Margin="0,0,0,10">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE890;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        <TextBlock l:Uids.Uid="Settings_HiddenSubApps" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    </StackPanel>
                    <TextBlock l:Uids.Uid="Settings_HiddenSubAppsDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                </StackPanel>
                <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
                <TextBox x:Name="TxtNewHiddenKeyword" PlaceholderText="e.g. YouTube, Secret Project..." Width="250" GotFocus="TxtNewHiddenKeyword_GotFocus" LostFocus="TxtNewHiddenKeyword_LostFocus"/>
                    <Button l:Uids.Uid="Settings_BtnAdd" Click="BtnAddHiddenKeyword_Click"/>
                </StackPanel>
                <ListView Grid.Row="2" x:Name="HiddenSubAppsList" MaxHeight="120" DoubleTapped="HiddenSubAppsList_DoubleTapped" Tapped="HiddenSubAppsList_Tapped" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" CornerRadius="4"/>
                <ToggleSwitch Grid.Row="3" x:Name="TglHideRetroactively" l:Uids.Uid="Settings_HideRetroactively" Margin="0,10,0,0" Toggled="TglHideRetroactively_Toggled"/>
            </Grid>

            <!-- Custom Title Rules -->
            <Grid Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Spacing="2" Margin="0,0,0,10">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8B7;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        <TextBlock l:Uids.Uid="Settings_CustomTitleRules" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    </StackPanel>
                    <TextBlock l:Uids.Uid="Settings_CustomTitleRulesDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                </StackPanel>
                
                <ListView Grid.Row="1" x:Name="CustomRulesList" MaxHeight="120" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" CornerRadius="4" Margin="0,0,0,10">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding FriendlyPattern}" FontWeight="SemiBold"/>
                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                        <TextBlock Text="→" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <TextBlock Text="{Binding Replacement}" FontStyle="Italic"/>
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                    <Button Content="&#xE70F;" FontFamily="Segoe MDL2 Assets" ToolTipService.ToolTip="Edit" Click="BtnEditRule_Click" Tag="{Binding}"/>
                                    <Button Content="&#xE74D;" FontFamily="Segoe MDL2 Assets" ToolTipService.ToolTip="Delete" Click="BtnDeleteRule_Click" Tag="{Binding}"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
                
                <Button Grid.Row="2" l:Uids.Uid="Settings_AddNewRule" Click="BtnAddRule_Click" HorizontalAlignment="Right"/>
            </Grid>
            
            <!-- Power Tracking Settings -->
            <Grid Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Spacing="2" Margin="0,0,0,10">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE945;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        <TextBlock l:Uids.Uid="Settings_PowerTitle" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    </StackPanel>
                    <TextBlock l:Uids.Uid="Settings_PowerDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                </StackPanel>
                
                <Grid Grid.Row="1" ColumnSpacing="15" RowSpacing="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Avg Watts -->
                    <StackPanel Grid.Column="0" Spacing="4">
                        <TextBlock l:Uids.Uid="Settings_AvgPower" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBox x:Name="TxtAvgWatts" PlaceholderText="e.g. 150" TextChanged="TxtAvgWatts_TextChanged"/>
                    </StackPanel>
                    
                    <!-- kWh Price -->
                    <StackPanel Grid.Column="1" Spacing="4">
                        <TextBlock l:Uids.Uid="Settings_KwhPrice" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBox x:Name="TxtKwhPrice" PlaceholderText="e.g. 0.15" TextChanged="TxtKwhPrice_TextChanged"/>
                    </StackPanel>
                    
                    <!-- Currency -->
                    <StackPanel Grid.Column="2" Spacing="4" Width="80">
                        <TextBlock l:Uids.Uid="Settings_Currency" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBox x:Name="TxtCurrency" PlaceholderText="$" TextChanged="TxtCurrency_TextChanged"/>
                    </StackPanel>
                </Grid>
            </Grid>

            <!-- Time Limits -->

            <Grid Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                 <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Spacing="2" Margin="0,0,0,10">
                    <TextBlock l:Uids.Uid="Settings_TimeLimits" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    <TextBlock l:Uids.Uid="Settings_TimeLimitsDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                </StackPanel>
                <ListView Grid.Row="1" x:Name="AppTimeLimitsList" MaxHeight="150" DoubleTapped="AppTimeLimitsList_DoubleTapped" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" CornerRadius="4"/>
            </Grid>
            </StackPanel>
            </Expander>

            <!-- Display -->
            <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" IsExpanded="False">
                 <Expander.Header>
                     <StackPanel Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_Display" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        <TextBlock l:Uids.Uid="Settings_DisplaySummary" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                     </StackPanel>
                 </Expander.Header>
                 <StackPanel Spacing="5" Padding="0,10,0,0">
                <!-- Days to Show -->
                 <Grid x:Name="GridDaysToShow" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                     <Grid.ColumnDefinitions>
                         <ColumnDefinition Width="*"/>
                         <ColumnDefinition Width="Auto"/>
                     </Grid.ColumnDefinitions>
                     <StackPanel Grid.Column="0" Spacing="2">
                         <TextBlock l:Uids.Uid="Settings_DaysToShow" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                          <TextBlock l:Uids.Uid="Settings_DaysToShowDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                     </StackPanel>
                       <StackPanel Orientation="Horizontal" Grid.Column="1" Spacing="10">
                          <NumberBox x:Name="DaysToShowTextBox" Value="7" SpinButtonPlacementMode="Compact" Width="150" Minimum="1" ValueChanged="Settings_ValueChanged" KeyUp="Settings_KeyUp"/>
                          <TextBlock x:Name="DaysAvailableHint" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" Visibility="Collapsed"/>
                      </StackPanel>
                 </Grid>

                 <!-- Days to Show on Detailed Usage -->
                 <Grid x:Name="GridDetailedDays" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                     <Grid.ColumnDefinitions>
                         <ColumnDefinition Width="*"/>
                         <ColumnDefinition Width="Auto"/>
                     </Grid.ColumnDefinitions>
                     <StackPanel Grid.Column="0" Spacing="2">
                          <TextBlock l:Uids.Uid="Settings_DetailedDays" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                          <TextBlock l:Uids.Uid="Settings_DetailedDaysDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                     </StackPanel>
                     <StackPanel Orientation="Horizontal" Grid.Column="1" Spacing="10">
                         <NumberBox x:Name="DetailedDaysTextBox" Value="1" SpinButtonPlacementMode="Compact" Width="150" Minimum="1" Maximum="7" ValueChanged="Settings_ValueChanged" KeyUp="Settings_KeyUp"/>
                     </StackPanel>
                 </Grid>

                 <!-- Minimum Duration -->
                <Grid x:Name="GridMinDuration" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_MinDuration" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        <TextBlock l:Uids.Uid="Settings_MinDurationDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Column="1" Spacing="10">
                        <NumberBox x:Name="MinDurationTextBox" Value="0" SpinButtonPlacementMode="Compact" Width="150" Minimum="0" ValueChanged="Settings_ValueChanged" KeyUp="Settings_KeyUp"/>
                    </StackPanel>
                </Grid>

                <!-- Refresh Interval -->
                <Grid x:Name="GridAutoRefresh" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_AutoRefresh" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                         <TextBlock l:Uids.Uid="Settings_AutoRefreshDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                    </StackPanel>
                     <StackPanel Orientation="Horizontal" Grid.Column="1" Spacing="10">
                         <ToggleSwitch x:Name="EnableAutoRefresh" Toggled="EnableAutoRefresh_Toggled"/>
                         <NumberBox x:Name="RefreshInterval" Width="150" SpinButtonPlacementMode="Compact" Minimum="6" Maximum="600" ValueChanged="RefreshInterval_ValueChanged" IsEnabled="{x:Bind EnableAutoRefresh.IsOn, Mode=OneWay}" KeyUp="Settings_KeyUp"/>
                     </StackPanel>
                </Grid>



                 <!-- Theme Mode -->
                <Grid x:Name="GridTheme" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_ThemeMode" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    </StackPanel>
                    <ComboBox x:Name="CBTheme" Grid.Column="1" SelectionChanged="CBTheme_SelectionChanged" Width="150">
                        <ComboBoxItem l:Uids.Uid="Settings_ThemeSystem" Tag="System"/>
                        <ComboBoxItem l:Uids.Uid="Settings_ThemeLight" Tag="Light"/>
                        <ComboBoxItem l:Uids.Uid="Settings_ThemeDark" Tag="Dark"/>
                    </ComboBox>
                </Grid>

                 <!-- Language -->
                <Grid x:Name="GridLanguage" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_Language" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        <TextBlock l:Uids.Uid="Settings_LanguageDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                    </StackPanel>
                    <ComboBox x:Name="CBLanguage" Grid.Column="1" Width="200" SelectionChanged="CBLanguage_SelectionChanged">
                        <ComboBoxItem Content="System Default" Tag=""/>
                        <ComboBoxItem Content="English" Tag="en-US"/>
                        <ComboBoxItem Content="Español (Spanish)" Tag="es-ES"/>
                        <ComboBoxItem Content="Français (French)" Tag="fr"/>
                        <ComboBoxItem Content="Deutsch (German)" Tag="de"/>
                        <ComboBoxItem Content="Italiano (Italian)" Tag="it"/>
                        <ComboBoxItem Content="Português (Brasil)" Tag="pt-BR"/>
                        <ComboBoxItem Content="中文 (Simplified)" Tag="zh-Hans"/>
                        <ComboBoxItem Content="日本語 (Japanese)" Tag="ja"/>
                        <ComboBoxItem Content="한국어 (Korean)" Tag="ko"/>
                        <ComboBoxItem Content="Русский (Russian)" Tag="ru"/>
                        <ComboBoxItem Content="Català (Catalan)" Tag="ca-ES"/>
                    </ComboBox>
                </Grid>
                
                <!-- Combined Audio View -->
                <Grid x:Name="GridCombinedAudio" Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_CombinedAudio" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        <TextBlock l:Uids.Uid="Settings_CombinedAudioDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                    </StackPanel>
                    <ToggleSwitch x:Name="ToggleCombinedAudioView" Grid.Column="1" Toggled="ToggleCombinedAudioView_Toggled"/>
                </Grid>
             </StackPanel>
            </Expander>

            <!-- Data -->
            <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" IsExpanded="False">
                <Expander.Header>
                    <StackPanel Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_Data" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        <TextBlock l:Uids.Uid="Settings_DataSummary" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                </Expander.Header>
                <StackPanel Spacing="10" Padding="0,10,0,0">
             <Grid Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                 <Grid.RowDefinitions>
                     <RowDefinition Height="Auto"/>
                     <RowDefinition Height="Auto"/>
                     <RowDefinition Height="Auto"/>
                 </Grid.RowDefinitions>
                 
                 <!-- Log Storage Location -->
                 <StackPanel Grid.Row="0" Spacing="5" Margin="0,0,0,10">
                      <TextBlock l:Uids.Uid="Settings_LogStorage" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                      <TextBlock l:Uids.Uid="Settings_LogStorageDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                     <Grid Margin="0,5,0,0">
                         <Grid.ColumnDefinitions>
                             <ColumnDefinition Width="*"/>
                             <ColumnDefinition Width="Auto"/>
                             <ColumnDefinition Width="Auto"/>
                             <ColumnDefinition Width="Auto"/>
                         </Grid.ColumnDefinitions>
                         <TextBox x:Name="TxtLogLocation" Grid.Column="0" PlaceholderText="Default Location" Margin="0,0,10,0" MaxWidth="400" HorizontalAlignment="Left" TextWrapping="NoWrap" AcceptsReturn="False" TextChanged="TxtLogLocation_TextChanged"/>
                          <Button Grid.Column="1" l:Uids.Uid="Settings_BtnOpen" Click="BtnOpenAppFolder_Click" Margin="0,0,5,0"/>
                          <Button Grid.Column="2" l:Uids.Uid="Settings_BtnBrowse" Click="BtnBrowseLogLocation_Click" Margin="0,0,5,0"/>
                          <Button Grid.Column="3" l:Uids.Uid="Settings_BtnReset" Click="BtnResetLogLocation_Click"/>
                     </Grid>
                 </StackPanel>

                  <!-- Data Flush Interval -->
                   <StackPanel Grid.Row="1" Spacing="5">
                       <TextBlock l:Uids.Uid="Settings_DataFlush" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                       <TextBlock l:Uids.Uid="Settings_DataFlushDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                       <StackPanel Orientation="Horizontal" Spacing="10">
                           <ToggleSwitch x:Name="ToggleUseRamCache" Toggled="ToggleUseRamCache_Toggled" OnContent="RAM Cache" OffContent="Direct Write"/>
                           <NumberBox x:Name="DataFlushIntervalTextBox" Value="300" SpinButtonPlacementMode="Compact" Width="150" Minimum="60" Maximum="1800" HorizontalAlignment="Left" ValueChanged="Settings_ValueChanged" KeyUp="Settings_KeyUp" IsEnabled="{x:Bind ToggleUseRamCache.IsOn, Mode=OneWay}"/>
                       </StackPanel>
                   </StackPanel>

                   <!-- Idle Threshold (AFK Detection) -->
                   <StackPanel Grid.Row="2" Spacing="5" Margin="0,10,0,0">
                       <TextBlock l:Uids.Uid="Settings_IdleThreshold" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                       <TextBlock l:Uids.Uid="Settings_IdleThresholdDesc" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                       <NumberBox x:Name="IdleThresholdTextBox" Value="300" SpinButtonPlacementMode="Compact" Width="150" Minimum="60" Maximum="3600" HorizontalAlignment="Left" ValueChanged="Settings_ValueChanged" KeyUp="Settings_KeyUp"/>
                   </StackPanel>
              </Grid>
              </StackPanel>
            </Expander>

             <!-- App Tags -->
             <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" IsExpanded="False">
                 <Expander.Header>
                     <StackPanel Spacing="2">
                        <TextBlock l:Uids.Uid="Settings_AppTags" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        <TextBlock l:Uids.Uid="Settings_AppTagsSummary" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                     </StackPanel>
                 </Expander.Header>
                 <StackPanel Spacing="10" Padding="0,10,0,0">
             <Grid Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="12">
                 <Grid.RowDefinitions>
                     <RowDefinition Height="Auto"/>
                     <RowDefinition Height="*"/>
                     <RowDefinition Height="Auto"/>
                 </Grid.RowDefinitions>
                 
                 <TextBlock l:Uids.Uid="Settings_ManageTags" Style="{ThemeResource BodyStrongTextBlockStyle}" Margin="0,0,0,10"/>

                 <ListView Grid.Row="1" ItemsSource="{x:Bind Tags}" SelectionMode="None">
                     <ListView.ItemTemplate>
                         <DataTemplate x:DataType="models:CustomAppTag">
                             <Grid Margin="0,4">
                                 <Grid.ColumnDefinitions>
                                     <ColumnDefinition Width="Auto"/> <!-- Color -->
                                     <ColumnDefinition Width="*"/>    <!-- Name -->
                                     <ColumnDefinition Width="Auto"/> <!-- Delete -->
                                 </Grid.ColumnDefinitions>
                                 
                                 <Button Grid.Column="0" Width="32" Height="32" CornerRadius="16" Margin="0,0,12,0" Padding="0"
                                         Background="{x:Bind helpers:AppTagHelper.GetBrush(HexColor), Mode=OneWay}">
                                     <Button.Flyout>
                                         <Flyout Closed="ColorPickerFlyout_Closed">
                                             <ColorPicker ColorSpectrumShape="Ring" IsMoreButtonVisible="True" IsColorSliderVisible="True" IsColorChannelTextInputVisible="False" 
                                                          ColorChanged="ColorPicker_ColorChanged" Tag="{x:Bind Id}"/>
                                         </Flyout>
                                     </Button.Flyout>
                                 </Button>
                                 
                                 <TextBox Grid.Column="1" Text="{x:Bind Name, Mode=TwoWay}" LostFocus="TagName_LostFocus" VerticalAlignment="Center"/>
                                 
                                 <Button Grid.Column="2" Content="&#xE74D;" FontFamily="Segoe MDL2 Assets" Click="BtnDeleteTag_Click" Tag="{x:Bind Id}" Margin="10,0,0,0" Background="Transparent"/>
                             </Grid>
                         </DataTemplate>
                     </ListView.ItemTemplate>
                 </ListView>
                 
                 <Button Grid.Row="2" l:Uids.Uid="Settings_AddTag" Click="BtnAddTag_Click" Margin="0,10,0,0"/>
             </Grid>
             </StackPanel>
            </Expander>


             <!-- About -->
             <TextBlock l:Uids.Uid="Settings_About" Style="{ThemeResource SubtitleTextBlockStyle}" Margin="0,10,0,5"/>
             <StackPanel Spacing="5">
                  <TextBlock x:Name="TxtCurrentVersion" Text="App Version: ..." Style="{ThemeResource BodyTextBlockStyle}"/>
                  <TextBlock l:Uids.Uid="Settings_CreatedBy" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                  <TextBlock l:Uids.Uid="Settings_Copyright" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                  <HyperlinkButton l:Uids.Uid="Settings_SourceCode" NavigateUri="https://github.com/Some1sm/UsageLogger-DigitalWellbeing"/>
             </StackPanel>

        </StackPanel>
        </Grid>
        </ScrollViewer>
    </Grid>
</Page>

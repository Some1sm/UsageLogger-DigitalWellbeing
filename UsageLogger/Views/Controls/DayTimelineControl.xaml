<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="UsageLogger.Views.Controls.DayTimelineControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="1440"
    d:DesignWidth="400">

    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Margin="7.5,15,7.5,15" Padding="15">
        <Grid x:Name="ContainerGrid" Margin="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Date Header -->
                <RowDefinition Height="*"/>    <!-- Timeline -->
            </Grid.RowDefinitions>

            <!-- Optional Date Header for Column -->
            <TextBlock x:Name="HeaderDate" Grid.Row="0" Text="{Binding DateString, Mode=OneWay}" 
                       Style="{ThemeResource BodyStrongTextBlockStyle}" HorizontalAlignment="Center" Margin="0,12,0,4"
                       Visibility="Visible"/> 

            <!-- Virtualized Timeline Container -->
            <Grid Grid.Row="1">
                <!-- ScrollViewer provides scroll mechanics with dummy content for height -->
                <ScrollViewer x:Name="TimelineScrollViewer" VerticalScrollBarVisibility="Auto" ViewChanged="TimelineScrollViewer_ViewChanged">
                    <Grid>
                        <!-- Invisible dummy content to maintain scrollable height -->
                        <Rectangle Height="{Binding CanvasHeight, Mode=OneWay}" Width="1" Fill="Transparent" IsHitTestVisible="False"/>
                        
                        <!-- Current Time Indicator (Red Line) -->
                        <Grid Width="{Binding ContentWidth, Mode=OneWay}" Height="2" 
                              VerticalAlignment="Top" HorizontalAlignment="Left"
                              Visibility="{Binding CurrentTimeVisibility, Mode=OneWay}">
                            <Grid.RenderTransform>
                                <TranslateTransform Y="{Binding CurrentTimeTop, Mode=OneWay}"/>
                            </Grid.RenderTransform>
                            <Rectangle Fill="#FF5252" />
                            <Ellipse Width="8" Height="8" Fill="#FF5252" HorizontalAlignment="Left" Margin="-4,0,0,0" VerticalAlignment="Center"/>
                        </Grid>
                    </Grid>
                </ScrollViewer>
                
                
                <!-- Win2D Canvas Container: CanvasControl is created in code-behind to bypass XAML compiler issues -->
                <Grid x:Name="CanvasContainer"/>
                
                <!-- Tooltip Overlay (Updated dynamically) -->
                <Border x:Name="TooltipOverlay" 
                        Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1" CornerRadius="6" Padding="8,4"
                        Visibility="Collapsed" IsHitTestVisible="False"
                        HorizontalAlignment="Left" VerticalAlignment="Top">
                    <StackPanel>
                        <TextBlock x:Name="TooltipTitle" FontWeight="SemiBold" FontSize="12"/>
                        <TextBlock x:Name="TooltipDuration" FontSize="11" Opacity="0.7"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </Border>
</UserControl>

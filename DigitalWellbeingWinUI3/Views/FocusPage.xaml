<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="DigitalWellbeingWinUI3.Views.FocusPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DigitalWellbeingWinUI3.Views"
    xmlns:models="using:DigitalWellbeingWinUI3.Models"
    Background="Transparent"
    Loaded="Page_Loaded">

    <Page.Resources>
        <!-- Mode to Icon Converter -->
        <local:FocusModeToIconConverter x:Key="ModeToIconConverter"/>
        <local:FocusModeToColorConverter x:Key="ModeToColorConverter"/>
        <local:BoolToVisibilityConverter x:Key="BoolToVisConverter"/>
    </Page.Resources>

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,24">
            <TextBlock Text="Focus Schedule" Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="Create scheduled focus blocks to stay on track. The app will enforce your commitment based on the selected mode."
                       Style="{StaticResource BodyTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       TextWrapping="Wrap"/>
            
            <!-- Status Bar -->
            <Grid Margin="0,12,0,0" Padding="16" CornerRadius="8" 
                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE768;" FontSize="20" 
                              Foreground="{Binding IsMonitoring, Converter={StaticResource ModeToColorConverter}}"/>
                    <TextBlock x:Name="StatusText" Text="Monitoring Inactive" VerticalAlignment="Center"/>
                </StackPanel>
                
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12">
                    <ToggleSwitch x:Name="MonitorToggle" 
                                  OnContent="Active" OffContent="Inactive"
                                  Toggled="MonitorToggle_Toggled"/>
                    <Button Content="+ Add Schedule" Style="{StaticResource AccentButtonStyle}"
                            Click="AddSchedule_Click"/>
                </StackPanel>
            </Grid>
        </StackPanel>

        <!-- Schedule List -->
        <ScrollViewer Grid.Row="1">
            <ItemsControl x:Name="ScheduleList" ItemsSource="{x:Bind Sessions}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:FocusSession">
                        <Grid Margin="0,0,0,12" Padding="16" CornerRadius="8"
                              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Mode Icon -->
                            <Border Grid.Column="0" Width="48" Height="48" CornerRadius="8" Margin="0,0,16,0"
                                    Background="{x:Bind Mode, Converter={StaticResource ModeToColorConverter}}">
                                <FontIcon Glyph="{x:Bind Mode, Converter={StaticResource ModeToIconConverter}}" 
                                          FontSize="20" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            
                            <!-- Details -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{x:Bind Name}" Style="{StaticResource SubtitleTextBlockStyle}"/>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Style="{StaticResource CaptionTextBlockStyle}" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                        <Run Text="{x:Bind DisplayName}"/>
                                        <Run Text=" • "/>
                                        <Run Text="{x:Bind StartTime}"/>
                                        <Run Text=" - "/>
                                        <Run Text="{x:Bind EndTime}"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Actions -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <ToggleSwitch IsOn="{x:Bind IsEnabled, Mode=TwoWay}" 
                                              OnContent="" OffContent=""
                                              Toggled="SessionToggle_Toggled"/>
                                <Button Content="Edit" Click="EditSession_Click" Tag="{x:Bind Id}"/>
                                <Button Click="DeleteSession_Click" Tag="{x:Bind Id}">
                                    <FontIcon Glyph="&#xE74D;" FontSize="14"/>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
        
        <!-- Empty State -->
        <StackPanel x:Name="EmptyState" Grid.Row="1" 
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    Visibility="Collapsed">
            <FontIcon Glyph="&#xE823;" FontSize="64" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            <TextBlock Text="No Focus Schedules" Style="{StaticResource SubtitleTextBlockStyle}" 
                       HorizontalAlignment="Center" Margin="0,16,0,8"/>
            <TextBlock Text="Click '+ Add Schedule' to create your first focus block."
                       Style="{StaticResource BodyTextBlockStyle}" 
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       HorizontalAlignment="Center"/>
        </StackPanel>
    </Grid>
</Page>

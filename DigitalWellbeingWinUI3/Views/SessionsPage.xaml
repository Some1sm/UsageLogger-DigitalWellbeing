<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="DigitalWellbeingWinUI3.Views.SessionsPage"
    x:Name="RootPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DigitalWellbeingWinUI3.Views"
    xmlns:controls="using:DigitalWellbeingWinUI3.Views.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="24,24,24,10">
            <StackPanel Spacing="4">
                <TextBlock Text="Timeline" Style="{ThemeResource TitleTextBlockStyle}"/>
                <TextBlock Text="Visualize your day." Style="{ThemeResource BodyTextBlockStyle}" Opacity="0.6"/>
            </StackPanel>
        </Grid>

        <!-- Controls -->
        <Grid Grid.Row="1" Margin="24,0,24,16" ColumnSpacing="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Date Navigation (Styled) -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="10" VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Background="Transparent" VerticalAlignment="Center" BorderThickness="0" Padding="0" Margin="0,0,10,0" ToolTipService.ToolTip="Select Date">
                            <TextBlock Text="ðŸ“…" VerticalAlignment="Center"/>
                            <Button.Flyout>
                                <Flyout x:Name="CalendarFlyout" Placement="Bottom">
                                    <CalendarView x:Name="CalendarPicker" SelectionMode="Single" SelectedDatesChanged="CalendarPicker_SelectedDatesChanged" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <TextBlock Text="{x:Bind ViewModel.SelectedDate, Converter={StaticResource DateFormatConverter}, Mode=OneWay}" 
                                   Style="{ThemeResource TitleTextBlockStyle}" FontSize="18" VerticalAlignment="Center" 
                                   Width="200" TextAlignment="Center" TextTrimming="CharacterEllipsis"/>
                        
                        <Button Content="&lt;" Command="{x:Bind ViewModel.PreviousDayCommand}" Background="Transparent" BorderThickness="0" Margin="10,0,0,0"/>
                        <Button Content="&gt;" Command="{x:Bind ViewModel.NextDayCommand}" IsEnabled="{x:Bind ViewModel.CanGoNext, Mode=OneWay}" Background="Transparent" BorderThickness="0"/>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Zoom Controls -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Command="{x:Bind ViewModel.ZoomOutCommand}" Content="Zoom Out"/>
                    <Button Command="{x:Bind ViewModel.ZoomInCommand}" Content="Zoom In"/>
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Timeline Body (Styled as Bubble) -->
        <Border Grid.Row="2" x:Name="TimelineContainer" Margin="24,0,24,24" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" SizeChanged="TimelineContainer_SizeChanged">
            <ScrollViewer VerticalScrollBarVisibility="Disabled" HorizontalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{x:Bind ViewModel.Days, Mode=OneWay}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="0"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <controls:SkiaTimelineControl Width="{Binding TimelineWidth}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>
    </Grid>
    
    <Page.Resources>
        <!-- Simple Date Converter -->
        <local:DateFormatConverter x:Key="DateFormatConverter"/>
    </Page.Resources>
</Page>
